<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starlink Token WiFi - High Speed Internet Solutions</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Supabase CDN MUST be loaded first -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Additional styles for clickable contact items */
        .contact-item.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .contact-item.clickable:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .contact-item.clickable:active {
            transform: translateY(-1px);
        }
        
        .clickable-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-top: 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: background 0.3s;
        }
        
        .clickable-btn:hover {
            background: #0da271;
        }
        
        .whatsapp-btn {
            background: #25D366;
        }
        
        .whatsapp-btn:hover {
            background: #1da851;
        }
        
        .email-btn {
            background: #EA4335;
        }
        
        .email-btn:hover {
            background: #d33426;
        }
        
        .call-btn {
            background: #2563eb;
        }
        
        .call-btn:hover {
            background: #1d4ed8;
        }
        
        /* Loading state for gallery */
        .loading-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            width: 100%;
        }
        
        .loading-item {
            height: 250px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /*hero*/
        .hero-features {
            margin-top: 2.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-features .feature {
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(6px);
            padding: 14px 18px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-size: 0.95rem;
        }

        .hero-features .feature i {
            font-size: 1.2rem;
            color: #10b981;
        }
        
        /* Messages Modal Styles */
        .messages-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .messages-modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .messages-modal-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .messages-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .message-item {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .message-item:hover {
            background-color: #f8f9fa;
        }
        
        .message-item.unread {
            background-color: #f0f7ff;
            border-left: 4px solid #2563eb;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .message-sender {
            font-weight: 600;
            color: #333;
        }
        
        .message-time {
            color: #666;
            font-size: 0.85rem;
        }
        
        .message-service {
            display: inline-block;
            background: #e2e8f0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            color: #4a5568;
        }
        
        .message-content {
            color: #555;
            margin-top: 0.5rem;
            line-height: 1.4;
        }
        
        .no-messages {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .messages-actions {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }
        
        .mark-read-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.3s;
        }
        
        .mark-read-btn:hover {
            background: #0da271;
        }
        
        .refresh-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.3s;
        }
        
        .refresh-btn:hover {
            background: #2563eb;
        }
        
        .export-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.3s;
        }
        
        .export-btn:hover {
            background: #7c3aed;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <img src="https://image2url.com/r2/default/images/1770561337315-920e5f5d-2254-4c03-8c95-c8eb7eac8442.jpg" alt="Starlink Token WiFi Logo">
                <span>Starlink Token WiFi</span>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#portfolio">Services</a></li>
                <li>
                    <a href="#gallery" class="dropdown-toggle">
                        Gallery <i class="fas fa-chevron-down"></i>
                    </a>
                    <div class="dropdown-menu">
                        <a href="#gallery-preview">Featured Projects</a>
                        <a href="javascript:void(0)" onclick="openGalleryModal()">View All Photos</a>
                        <a href="#contact">Request Site Visit</a>
                    </div>
                </li>
                <li>
                    <a href="#bundles" class="dropdown-toggle">
                        Bundles <i class="fas fa-chevron-down"></i>
                    </a>
                    <div class="dropdown-menu">
                        <a href="javascript:void(0)" onclick="showBundles()">View All Bundles</a>
                        <a href="#contact">Get Custom Quote</a>
                        <a href="#contact">Business Solutions</a>
                    </div>
                </li>
                <li><a href="#contact">Contact</a></li>
                <li>
                    <a href="javascript:void(0)" class="admin-btn" id="messages-notification" style="position: relative;">
                        <i class="fas fa-envelope"></i> Messages 
                        <span id="message-count" class="notification-badge" style="display: none;">0</span>
                    </a>
                </li>
            </ul>
            <div class="mobile-menu">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- HERO -->
<section id="home" class="hero">
    <div class="container">
        <div class="hero-content">
            <h1>High-Speed WiFi Solutions</h1>
            <p>Reliable, scalable WiFi infrastructure for homes, businesses, and managed networks</p>

            <div class="hero-features">
                <div class="feature">
                    <i class="fas fa-building"></i>
                    <span>Enterprise & ISP-Grade Installations</span>
                </div>
                <div class="feature">
                    <i class="fas fa-network-wired"></i>
                    <span>Business & Residential Networks</span>
                </div>
                <div class="feature">
                    <i class="fas fa-headset"></i>
                    <span>24/7 Technical Support</span>
                </div>
                <div class="feature">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Nakuru & Nationwide Coverage</span>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="portfolio">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Our Professional Services</h2>
                <p class="section-subtitle">Comprehensive internet solutions for modern needs</p>
            </div>
            
            <div class="portfolio-grid">
                <div class="portfolio-card">
                    <div class="card-icon">
                        <i class="fas fa-wifi"></i>
                    </div>
                    <h3>WiFi Installation</h3>
                    <p>Professional installation of high-speed WiFi networks with modern equipment</p>
                    <a href="#contact" class="card-link">Get Quote →</a>
                </div>
                
                <div class="portfolio-card featured">
                    <div class="card-badge">Popular</div>
                    <div class="card-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h3>Data Bundles</h3>
                    <p>Premium Safaricom data bundles with competitive pricing</p>
                    <button onclick="showBundles()" class="card-link">View Bundles →</button>
                </div>
                
                <div class="portfolio-card">
                    <div class="card-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3>24/7 Support</h3>
                    <p>Round-the-clock technical support and maintenance</p>
                    <a href="#contact" class="card-link">Contact Support →</a>
                </div>
                
                <div class="portfolio-card">
                    <div class="card-icon">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <h3>Network Setup</h3>
                    <p>Complete network infrastructure setup for businesses</p>
                    <a href="#contact" class="card-link">Learn More →</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Preview Section -->
    <section id="gallery-preview" class="gallery-preview">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Featured Projects</h2>
                <p class="section-subtitle">A glimpse of our professional installations</p>
            </div>
            
            <div class="gallery-preview-grid" id="gallery-preview-container">
                <!-- Preview images loaded dynamically -->
                <div class="loading-gallery">
                    <div class="loading-item"></div>
                    <div class="loading-item"></div>
                    <div class="loading-item"></div>
                </div>
            </div>
            
            <div class="section-footer">
                <button onclick="openGalleryModal()" class="btn btn-primary">
                    <i class="fas fa-images"></i> View Complete Gallery
                </button>
                <a href="#contact" class="btn btn-outline">
                    <i class="fas fa-camera"></i> Request Project Photos
                </a>
            </div>
        </div>
    </section>

    <!-- Bundles Section (Hidden by default - shows on button click) -->
    <section id="bundles" class="bundles" style="display: none;">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Data Bundles & Pricing</h2>
                <p class="section-subtitle">Select the perfect plan for your needs</p>
                <button onclick="hideBundles()" class="close-bundles">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            
            <div class="bundles-grid" id="bundles-container">
                <!-- Bundles loaded dynamically -->
            </div>
            
            <div class="bundles-actions">
                <button onclick="openWhatsApp()" class="btn btn-primary">
                    <i class="fab fa-whatsapp"></i> WhatsApp for Custom Plan
                </button>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Get In Touch</h2>
                <p class="section-subtitle">Contact us for professional consultation</p>
            </div>
            
            <div class="contact-wrapper">
                <div class="contact-info">
                    <div class="contact-item clickable" onclick="callNow()">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h3>Call Us</h3>
                            <p>0740 851 330</p>
                            <button class="clickable-btn call-btn">
                                <i class="fas fa-phone"></i> Call Now
                            </button>
                        </div>
                    </div>
                    
                    <div class="contact-item clickable" onclick="openWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                        <div>
                            <h3>WhatsApp</h3>
                            <p>Chat with us instantly</p>
                            <button class="clickable-btn whatsapp-btn">
                                <i class="fab fa-whatsapp"></i> Open WhatsApp
                            </button>
                        </div>
                    </div>
                    
                    <div class="contact-item clickable" onclick="sendEmail()">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h3>Email</h3>
                            <p>starlinktokenwifi@gmail.com</p>
                            <button class="clickable-btn email-btn">
                                <i class="fas fa-envelope"></i> Send Email
                            </button>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h3>Business Hours</h3>
                            <p>Mon - Sat: 8:00 AM - 6:00 PM</p>
                            <p>Sunday: Emergency Only</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h3>Location</h3>
                            <p>Nairobi, Kenya</p>
                            <button class="clickable-btn" onclick="openLocation()" style="background: #8b5cf6;">
                                <i class="fas fa-map"></i> View on Map
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="contact-form">
                    <form id="contact-form">
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" id="name" placeholder="Your Name" required>
                            </div>
                            <div class="form-group">
                                <input type="email" id="email" placeholder="Email Address" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <input type="tel" id="phone" placeholder="Phone Number (e.g., 0740 851 330)">
                        </div>
                        
                        <div class="form-group">
                            <select id="service">
                                <option value="">Select Service</option>
                                <option value="wifi">WiFi Installation</option>
                                <option value="bundles">Data Bundles</option>
                                <option value="support">Technical Support</option>
                                <option value="consultation">Consultation</option>
                                <option value="business">Business Solutions</option>
                                <option value="home">Home Solutions</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <textarea id="message" rows="4" placeholder="Your message..." required></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                    </form>
                    <div id="form-message"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="https://image2url.com/r2/default/images/1770561337315-920e5f5d-2254-4c03-8c95-c8eb7eac8442.jpg" alt="Logo">
                    <div>
                        <h3>Starlink Token WiFi</h3>
                        <p>Professional Internet Solutions</p>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#portfolio">Services</a></li>
                        <li><a href="javascript:void(0)" onclick="openGalleryModal()">Gallery</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h4>Contact Info</h4>
                    <p><i class="fas fa-map-marker-alt"></i> Nakuru, Kenya</p>
                    <p><i class="fas fa-phone"></i> 0740 851 330</p>
                    <p><i class="fas fa-envelope"></i> starlinktokenwifi@gmail.com</p>
                    <div class="footer-buttons" style="margin-top: 1rem; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="clickable-btn call-btn" onclick="callNow()" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-phone"></i> Call
                        </button>
                        <button class="clickable-btn whatsapp-btn" onclick="openWhatsApp()" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        <button class="clickable-btn email-btn" onclick="sendEmail()" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-envelope"></i> Email
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 Starlink Token WiFi. All rights reserved.</p>
                <div class="social-links">
                    <a href="#" onclick="openFacebook()"><i class="fab fa-facebook"></i></a>
                    <a href="#" onclick="openTwitter()"><i class="fab fa-twitter"></i></a>
                    <a href="#" onclick="openInstagram()"><i class="fab fa-instagram"></i></a>
                    <a href="#" onclick="openWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Gallery Modal -->
    <div id="galleryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-images"></i> Complete Project Gallery</h3>
                <button class="modal-close" onclick="closeGalleryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="gallery-filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="installation">Installations</button>
                    <button class="filter-btn" data-filter="business">Business</button>
                    <button class="filter-btn" data-filter="home">Home</button>
                </div>
                <div class="modal-gallery" id="modalGalleryContainer">
                    <!-- Full gallery loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Modal -->
    <div id="messagesModal" class="messages-modal">
        <div class="messages-modal-content">
            <div class="messages-modal-header">
                <h3><i class="fas fa-envelope"></i> Customer Messages</h3>
                <button class="modal-close" onclick="closeMessagesModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="messages-modal-body" id="messagesContainer">
                <!-- Messages will be loaded here -->
                <div class="no-messages">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p>Loading messages...</p>
                </div>
            </div>
            <div class="messages-actions">
                <button onclick="markAllAsRead()" class="mark-read-btn">
                    <i class="fas fa-check-double"></i> Mark All as Read
                </button>
                <button onclick="refreshMessages()" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button onclick="exportMessages()" class="export-btn">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <div class="notification-content">
            <i class="fas fa-info-circle"></i>
            <span id="notification-message"></span>
            <button class="notification-close" onclick="closeNotification()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/main-browser.js"></script>
    
    <!-- Messages JavaScript -->
    <script>
        // Global variables
        let supabase;
        let messages = [];
        
        // Supabase configuration (from your main-browser.js)
        const SUPABASE_URL = 'https://jgaeldguwezbgglwaivz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpnYWVsZGd1d2V6YmdnbHdhaXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1Nzg1NTAsImV4cCI6MjA4NjE1NDU1MH0.pAkRxRs1gvmrJJR_CNietYes6ju6qOMP8Etnpr3TtyQ';
        
        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Supabase
            if (window.supabase) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Supabase client initialized for messages');
            }
            
            // Setup messages button click handler
            const messagesBtn = document.getElementById('messages-notification');
            if (messagesBtn) {
                messagesBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    openMessagesModal();
                });
            }
            
            // Load unread count on page load
            loadUnreadCount();
            
            // Set up periodic update of message count
            setInterval(loadUnreadCount, 60000); // Update every minute
            
            // Add event listener for contact form submission
            setupContactForm();
        });
        
        // Contact action functions
        function callNow() {
            const phoneNumber = '0740851330';
            if (confirm(`Call ${phoneNumber}?`)) {
                window.location.href = `tel:${phoneNumber}`;
            }
        }
        
        function openWhatsApp() {
            const phoneNumber = '254740851330';
            const message = 'Hello Starlink Token WiFi, I am interested in your services.';
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        function sendEmail() {
            const email = 'starlinktokenwifi@gmail.com';
            const subject = 'Inquiry about Starlink Token WiFi Services';
            const body = 'Hello Starlink Token WiFi,\n\nI would like to inquire about your services.\n\nBest regards,';
            const mailtoUrl = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoUrl;
        }
        
        function openLocation() {
            const address = 'Nakuru, Kenya';
            const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`;
            window.open(mapsUrl, '_blank');
        }
        
        // Social media functions
        
        function openTwitter() {
            window.open('https://twitter.com', '_blank');
        }
        
        function openInstagram() {
            window.open('https://instagram.com', '_blank');
        }
        
        // MESSAGES FUNCTIONS
        function openMessagesModal() {
            document.getElementById('messagesModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            loadMessages();
        }
        
        function closeMessagesModal() {
            document.getElementById('messagesModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Refresh unread count when closing modal
            loadUnreadCount();
        }
        
        async function loadMessages() {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '<div style="text-align: center; padding: 2rem;"><i class="fas fa-spinner fa-spin"></i> Loading messages...</div>';
            
            try {
                if (!supabase) {
                    throw new Error('Supabase client not initialized');
                }
                
                // Fetch messages from Supabase
                const { data, error } = await supabase
                    .from('messages')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Supabase error:', error);
                    throw error;
                }
                
                messages = data || [];
                displayMessages(messages);
                
            } catch (error) {
                console.error('Error loading messages:', error);
                container.innerHTML = `
                    <div class="no-messages">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;"></i>
                        <h3>Error Loading Messages</h3>
                        <p>${error.message || 'Please try again later'}</p>
                        <button onclick="loadMessages()" class="btn btn-secondary" style="margin-top: 1rem;">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </div>
                `;
            }
        }
        
        function displayMessages(messagesList) {
            const container = document.getElementById('messagesContainer');
            
            if (!messagesList || messagesList.length === 0) {
                container.innerHTML = `
                    <div class="no-messages">
                        <i class="fas fa-envelope-open" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <p>No messages yet</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            messagesList.forEach(message => {
                const time = new Date(message.created_at).toLocaleString();
                const isUnread = !message.read;
                const phoneDisplay = message.phone ? message.phone : 'No phone provided';
                
                html += `
                    <div class="message-item ${isUnread ? 'unread' : ''}" data-id="${message.id}" onclick="markMessageAsRead('${message.id}')">
                        <div class="message-header">
                            <div class="message-sender">${message.name || 'Unknown'}</div>
                            <div class="message-time">${time}</div>
                        </div>
                        <div>
                            ${message.service ? `<span class="message-service">${message.service}</span>` : ''}
                            <span style="color: #666; font-size: 0.9rem;">${phoneDisplay}</span>
                        </div>
                        <div style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">
                            <i class="fas fa-envelope"></i> ${message.email}
                        </div>
                        <div class="message-content">${message.message || 'No message content'}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        async function markMessageAsRead(messageId) {
            try {
                if (!supabase) return;
                
                const { error } = await supabase
                    .from('messages')
                    .update({ read: true, read_at: new Date().toISOString() })
                    .eq('id', messageId);
                
                if (error) throw error;
                
                // Update UI
                const item = document.querySelector(`.message-item[data-id="${messageId}"]`);
                if (item) {
                    item.classList.remove('unread');
                }
                
                // Update unread count
                loadUnreadCount();
                
            } catch (error) {
                console.error('Error marking message as read:', error);
                showNotification('Error updating message status', 'error');
            }
        }
        
        async function markAllAsRead() {
            try {
                if (!supabase) return;
                
                const { error } = await supabase
                    .from('messages')
                    .update({ read: true, read_at: new Date().toISOString() })
                    .eq('read', false);
                
                if (error) throw error;
                
                // Update UI
                document.querySelectorAll('.message-item').forEach(item => {
                    item.classList.remove('unread');
                });
                
                // Update unread count
                loadUnreadCount();
                
                showNotification('All messages marked as read', 'success');
                
            } catch (error) {
                console.error('Error marking all as read:', error);
                showNotification('Error updating messages', 'error');
            }
        }
        
        async function loadUnreadCount() {
            try {
                if (!supabase) return;
                
                const { count, error } = await supabase
                    .from('messages')
                    .select('*', { count: 'exact', head: true })
                    .eq('read', false);
                
                if (error) throw error;
                
                updateBadge(count || 0);
                
            } catch (error) {
                console.error('Error loading unread count:', error);
            }
        }
        
        function updateBadge(count) {
            const badge = document.getElementById('message-count');
            if (!badge) return;
            
            if (count > 0) {
                badge.textContent = count > 9 ? '9+' : count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function refreshMessages() {
            loadMessages();
            showNotification('Messages refreshed', 'success');
        }
        
        function exportMessages() {
            if (messages.length === 0) {
                showNotification('No messages to export', 'warning');
                return;
            }
            
            // Convert messages to CSV
            const headers = ['Name', 'Email', 'Phone', 'Service', 'Message', 'Date', 'Read'];
            const csvRows = [
                headers.join(','),
                ...messages.map(msg => [
                    `"${msg.name || ''}"`,
                    `"${msg.email || ''}"`,
                    `"${msg.phone || ''}"`,
                    `"${msg.service || ''}"`,
                    `"${msg.message || ''}"`,
                    `"${new Date(msg.created_at).toLocaleString()}"`,
                    `"${msg.read ? 'Yes' : 'No'}"`
                ].join(','))
            ];
            
            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `messages_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Messages exported successfully', 'success');
        }
        
        function showNotification(message, type = 'info') {
            const toast = document.getElementById('notification-toast');
            const messageEl = document.getElementById('notification-message');
            
            if (toast && messageEl) {
                // Set color based on type
                const colors = {
                    'success': '#10b981',
                    'error': '#ef4444',
                    'warning': '#f59e0b',
                    'info': '#3b82f6'
                };
                
                toast.style.backgroundColor = colors[type] || colors.info;
                messageEl.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }
        
        function closeNotification() {
            const toast = document.getElementById('notification-toast');
            if (toast) {
                toast.classList.remove('show');
            }
        }
        
        function setupContactForm() {
            const form = document.getElementById('contact-form');
            if (!form) return;
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const service = document.getElementById('service').value;
                const message = document.getElementById('message').value.trim();
                const formMessage = document.getElementById('form-message');
                
                // Basic validation
                if (!name || !email || !message) {
                    formMessage.innerHTML = '<p class="error">Please fill in all required fields</p>';
                    formMessage.style.color = '#ef4444';
                    return;
                }
                
                // Validate email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    formMessage.innerHTML = '<p class="error">Please enter a valid email address</p>';
                    formMessage.style.color = '#ef4444';
                    return;
                }
                
                const formData = {
                    name: name,
                    email: email,
                    phone: phone || null,
                    service: service || null,
                    message: message,
                    read: false,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                // Save to Supabase
                try {
                    if (!supabase) {
                        throw new Error('Database connection not available');
                    }
                    
                    const { error } = await supabase
                        .from('messages')
                        .insert([formData]);
                    
                    if (error) throw error;
                    
                    // Show success message
                    formMessage.innerHTML = '<p class="success">Message sent successfully! We\'ll contact you soon.</p>';
                    formMessage.style.color = '#10b981';
                    form.reset();
                    
                    // Refresh messages count
                    loadUnreadCount();
                    
                    // Auto-hide message after 5 seconds
                    setTimeout(() => {
                        formMessage.innerHTML = '';
                    }, 5000);
                    
                } catch (error) {
                    console.error('Error saving message:', error);
                    formMessage.innerHTML = '<p class="error">Error sending message. Please try again.</p>';
                    formMessage.style.color = '#ef4444';
                }
            });
        }
        
        // Make functions available globally
        window.callNow = callNow;
        window.openWhatsApp = openWhatsApp;
        window.sendEmail = sendEmail;
        window.openLocation = openLocation;
        window.openFacebook = openFacebook;
        window.openTwitter = openTwitter;
        window.openInstagram = openInstagram;
        window.openMessagesModal = openMessagesModal;
        window.closeMessagesModal = closeMessagesModal;
        window.markAllAsRead = markAllAsRead;
        window.refreshMessages = refreshMessages;
        window.exportMessages = exportMessages;
        window.closeNotification = closeNotification;
    </script>
</body>
</html>
